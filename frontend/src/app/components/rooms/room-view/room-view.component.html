<!-- Main Card Container -->
<div *ngIf="room; else loadingRoomView" class="flex items-center justify-center h-full">
  <div class="bg-white rounded-xl shadow-lg p-10 border w-[90%] border-gray-300">
    <!-- Back Button -->
    <div class="relative mb-4">
      <a
        routerLink="/rooms"
        class="group flex items-center justify-center w-10 h-10 rounded-full hover:bg-indigo-50 hover:text-indigo-700 active:bg-indigo-100 text-white transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="2" class="w-6 h-6 stroke-indigo-800">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
        </svg>
      </a>
    </div>

    <!-- Room Image -->
    <div class="relative flex justify-center">
      <img
        [src]="room.roomPictureUrl"
        alt="Room Image"
        class="w-[150px] h-[150px] rounded-full object-cover border-4 border-indigo-100">
    </div>

    <!-- Room Name -->
    <h2 class="my-8 text-center text-2xl font-bold text-indigo-700 flex items-center">
      <span class="h-px flex-1 bg-gray-300"></span>
      <span class="shrink-0 px-6">{{ room.roomName }}</span>
      <span class="h-px flex-1 bg-gray-300"></span>
    </h2>

    <!-- Admin Card -->
    <div
      [routerLink]="['/profile', room.creator.userId]"
      class="my-8 bg-indigo-50 rounded-lg py-3 px-6 flex items-center w-fit mx-auto cursor-pointer hover:scale-95 active:scale-90 transition select-none">
      <img [src]="room.creator.profilePictureUrl" alt="Admin Image" class="w-8 h-8 rounded-full">
      <div class="ml-3">
        <p class="text-lg font-medium text-indigo-600">
          Created by {{ room.creator.firstName }} {{ room.creator.lastName }}
        </p>
      </div>
    </div>

    <!-- Room Description -->
    <div class="my-8">
      <p class="text-gray-600 text-lg text-center">
        {{ room.roomDescription }}
      </p>
    </div>

    <!-- Action Buttons -->
    <div class="mt-12 flex justify-between space-x-4">
      <button
        type="button"
        class="cursor-pointer bg-indigo-500 hover:bg-indigo-700 active:bg-indigo-800 text-white px-4 py-2 rounded-full flex items-center justify-center flex-1 transition-colors gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-chat-left-text-fill" viewBox="0 0 16 16">
          <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H4.414a1 1 0 0 0-.707.293L.854 15.146A.5.5 0 0 1 0 14.793zm3.5 1a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1zm0 2.5a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1zm0 2.5a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1z"/>
        </svg>
        Chat
      </button>

      <button
        (click)="showRequests()"
        type="button"
        class="cursor-pointer bg-indigo-500 hover:bg-indigo-700 active:bg-indigo-800 text-white px-4 py-2 rounded-full flex items-center justify-center flex-1 transition-colors gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-person-fill-exclamation" viewBox="0 0 16 16">
          <path d="M11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0m-9 8c0 1 1 1 1 1h5.256A4.5 4.5 0 0 1 8 12.5a4.5 4.5 0 0 1 1.544-3.393Q8.844 9.002 8 9c-5 0-6 3-6 4"/>
          <path d="M16 12.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0m-3.5-2a.5.5 0 0 0-.5.5v1.5a.5.5 0 0 0 1 0V11a.5.5 0 0 0-.5-.5m0 4a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1"/>
        </svg>
        Pending requests
      </button>

      <button
        (click)="leaveRoom()"
        class="cursor-pointer bg-red-500 hover:bg-red-700 active:bg-red-800 text-white px-4 py-2 rounded-full flex items-center justify-center flex-1 transition-colors gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-door-open-fill" viewBox="0 0 16 16">
          <path d="M1.5 15a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1H13V2.5A1.5 1.5 0 0 0 11.5 1H11V.5a.5.5 0 0 0-.57-.495l-7 1A.5.5 0 0 0 3 1.5V15zM11 2h.5a.5.5 0 0 1 .5.5V15h-1zm-2.5 8c-.276 0-.5-.448-.5-1s.224-1 .5-1 .5.448.5 1-.224 1-.5 1"/>
        </svg>
        Leave
      </button>
    </div>
  </div>
</div>

<div *ngIf="memberships; else loadingMemberships" class="flex items-center justify-center">
  <div class="bg-white rounded-xl shadow-lg p-10 border w-[90%] border-gray-300">
    <div class="flex justify-between items-center pb-6 mb-6 border-b border-gray-200">
      <h3 class="text-2xl font-bold text-gray-700 flex items-center gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="rounded-full bg-indigo-100 size-12 text-indigo-600 font-bold p-3">
          <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0ZM3.75 12h.007v.008H3.75V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm-.375 5.25h.007v.008H3.75v-.008Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
        </svg>
        Members ({{ memberships.length }})
      </h3>
    </div>

    <!-- Scrollable members area -->
    <div class="overflow-y-auto h-full w-full">
      <div class="border overflow-y-auto rounded-lg h-full w-full border-gray-200 px-6 py-6">
        <div
          *ngFor="let membership of memberships; let i = index"
          [class]="'border-b border-gray-200 ' + (i === 0 ? 'border-t' : '')">
          <app-member-card
            [membership]="membership"
            [isMembershipRequest]="false"
            (membershipCanceled)="onRemove($event)">
          </app-member-card>
        </div>
      </div>
    </div>
  </div>
</div>

<app-membership-requests
  [roomId]="roomId"
  (hideRequests)="hideRequests()"
  (membershipAccepted)="getMemberships()"
  *ngIf="requestsShown">
</app-membership-requests>

<ng-template #loadingRoomView>
  <!-- Main Container (same as your card) -->
  <div class="flex items-center justify-center h-full">
    <div class="bg-white rounded-xl shadow-lg p-12 w-[90%] border border-gray-300 animate-pulse">

      <!-- Back Button Skeleton -->
      <div class="relative mb-4">
        <div class="w-12 h-12 rounded-full bg-gray-200"></div>
      </div>

      <!-- Room Image Skeleton -->
      <div class="flex justify-center">
        <div class="w-[150px] h-[150px] rounded-full bg-gray-200 border-4 border-gray-100"></div>
      </div>

      <!-- Room Name Skeleton -->
      <div class="my-8 flex items-center">
        <div class="h-px flex-1 bg-gray-200"></div>
        <div class="shrink-0 px-6 w-40 h-8 bg-gray-200 rounded"></div>
        <div class="h-px flex-1 bg-gray-200"></div>
      </div>

      <!-- Admin Card Skeleton -->
      <div class="my-8 bg-gray-100 rounded-lg py-3 px-6 flex items-center w-fit mx-auto">
        <div class="w-8 h-8 rounded-full bg-gray-300"></div>
        <div class="ml-3 w-32 h-6 bg-gray-300 rounded"></div>
      </div>

      <!-- Description Skeleton -->
      <div class="my-8 space-y-2">
        <div class="h-4 bg-gray-200 rounded w-full"></div>
      </div>

      <!-- Buttons Skeleton -->
      <div class="mt-12 flex justify-between space-x-4">
        <div class="flex-1 h-12 bg-gray-200 rounded-full"></div>
        <div class="flex-1 h-12 bg-gray-200 rounded-full"></div>
        <div class="flex-1 h-12 bg-gray-200 rounded-full"></div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #loadingMemberships>
  <div class="flex items-center justify-center animate-pulse">
    <div class="bg-white rounded-xl shadow-lg p-10 border w-[90%] border-gray-300">
      <!-- Header Skeleton -->
      <div class="flex justify-between items-center pb-6 mb-6 border-b border-gray-200">
        <div class="flex items-center gap-3">
          <div class="rounded-full bg-indigo-100 size-12 p-3 text-indigo-600"></div>
          <div class="h-8 w-40 bg-gray-200 rounded"></div>
        </div>
      </div>

      <!-- Members List Skeleton -->
      <div class="overflow-y-auto h-full w-full">
        <div class="border rounded-lg h-full w-full border-gray-200 px-6 py-6">
          <!-- Repeat skeleton cards (4 items) -->
          <div class="bg-white flex justify-between items-center gap-4 lg:gap-8 border-gray-200 p-4 animate-pulse">
            <!-- Left Side (Avatar + Text) -->
            <div class="flex items-center gap-4 w-full">
              <!-- Avatar Skeleton -->
              <div class="h-10 w-10 rounded-full bg-gray-200"></div>

              <!-- Text Content Skeleton -->
              <div class="flex-1 space-y-2">
                <!-- Name + Username -->
                <div class="flex items-center gap-2 flex-wrap">
                  <div class="h-4 w-24 bg-gray-200 rounded"></div>
                  <div class="h-3 w-16 bg-gray-200 rounded"></div>
                </div>

                <!-- Admin Badge Placeholder -->
                <div class="h-4 w-12 bg-gray-200 rounded-full"></div>
              </div>
            </div>

            <!-- Right Side (Buttons) -->
            <div class="flex gap-2 min-w-[180px]">
              <!-- Message Button Skeleton -->
              <div class="h-8 w-20 bg-gray-200 rounded-full"></div>

              <!-- Remove Button Skeleton -->
              <div class="h-8 w-20 bg-gray-200 rounded-full"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>
